<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Agregar Categoría - TecMerch</title>
  <link rel="stylesheet" href="../../../style/private/categorias/categorias_agregar.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    .formulario { max-width: 500px; margin: 0 auto; }
    input { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 6px; }
    .acciones-form { margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end; }
    .btn-guardar, .btn-cancelar {
      padding: 10px 20px; border-radius: 6px; text-decoration: none; text-align: center;
    }
    .btn-guardar { background: #27ae60; color: white; border: none; cursor: pointer; }
    .btn-cancelar { background: #95a5a6; color: white; }
  </style>
</head>
<body>
  <div class="contenedor">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <i class="bi bi-shop"></i> TecMerch
      </div>
      <nav>
        <a href="../ventas/ventas.html"><i class="bi bi-cart"></i> Ventas</a>
        <a href="../productos/productos.html"><i class="bi bi-box-seam"></i> Productos</a>
        <a href="../clientes/clientes.html"><i class="bi bi-people"></i> Clientes</a>
        <a href="categorias.html" class="activo"><i class="bi bi-tags"></i> Categorías</a>
        <a href="../reportes.html"><i class="bi bi-file-earmark-bar-graph"></i> Reportes</a>
        <a href="../citas_tecnicas/citas_tecnicas.html"><i class="bi bi-tools"></i> Citas Técnicas</a>
      </nav>
    </aside>

    <!-- Contenido -->
    <main class="contenido">
      <h1><i class="bi bi-plus-circle"></i> Agregar Categoría</h1>

      <form id="formAgregar" class="formulario">
        <label for="nombre">Nombre de la categoría</label>
        <input type="text" id="nombre" placeholder="Ej. Laptop Gamer" required>

        <label for="descripcion">Descripción</label>
        <input type="text" id="descripcion" placeholder="Breve descripción" required>

        <div class="acciones-form">
          <a href="categorias.html" class="btn-cancelar">Cancelar</a>
          <button type="submit" class="btn-guardar">Guardar</button>
        </div>
      </form>
    </main>
  </div>

  <script>
    // === Generar ID: CAT001, CAT002... ===
    function generarId() {
      const categorias = JSON.parse(localStorage.getItem("categorias")) || [];
      const max = categorias.reduce((m, c) => Math.max(m, parseInt(c.id.replace("CAT", "")) || 0), 0);
      return "CAT" + String(max + 1).padStart(3, "0");
    }

    document.getElementById("formAgregar").onsubmit = function(e) {
      e.preventDefault();

      const nombre = document.getElementById("nombre").value.trim();
      const descripcion = document.getElementById("descripcion").value.trim();

      if (!nombre || !descripcion) {
        alert("Completa todos los campos.");
        return;
      }

      // Verificar duplicado
      const categorias = JSON.parse(localStorage.getItem("categorias")) || [];
      if (categorias.some(c => c.nombre.toLowerCase() === nombre.toLowerCase())) {
        alert("Esta categoría ya existe.");
        return;
      }

      const nueva = { id: generarId(), nombre, descripcion };
      categorias.push(nueva);
      localStorage.setItem("categorias", JSON.stringify(categorias));

      alert(`Categoría ${nueva.id} agregada: ${nombre}`);
      window.location.href = "categorias.html";
    };
  </script>
</body>
</html>